#!/usr/bin/env jstar
importPaths.insert(0, '../')
import test for test, run, skip

import io

import server_utils for spawnUDPServer

import event_horizon as evh
import event_horizon.errors for strerror, LoopExecutionException, StatusException
import event_horizon.udp for UDP

@test
fun bind()
    var udp = UDP()    
    udp.bind('0.0.0.0', 8080)
    udp.close()
    evh.loop().run()
end

@test
fun bindFail()
    var udp = UDP()
    udp.bind('0.0.0.0', 8080)

    var didThrow = true
    try
        udp.bind('0.0.0.0', 8080)
    except StatusException e
        didThrow = true
    end

    assert(didThrow, "second bind did not throw")

    udp.close()
    evh.loop().run()
end

@test
fun connect()
    var udp = UDP()
    udp.connect('127.0.0.1', 8080)
    udp.connect(null)
    udp.close()
    evh.loop().run()
end

@test
fun send()
    // var server = spawnUDPServer(8080)
    // var udp = UDP()
    assert(false, "TODO")
end

if __name__ == '__main__'
    run()
end
